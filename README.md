# GCN: Generative Collaborative Networks

## Introduction
This repository contains code for the paper titled "GCN:Generative Collaborative Networks"
In this type of GAN, we try to develop a synergy between multiple generators to efficiently and robustly generate multi-modal datasets.

## Requirements and usage instructions
Before running any code, please make sure you have set up your workspace using the `requirements.txt` supplied in the "batch_concatenation" branch.

This repository has 4 main branches, each corresponding to a different experiment. 

1. `batch_concatenation` - This branch contains code related to the batch concatenation experiment as mentioned in the paper. (this is the default branch)
2. `4_gen` - This branch extends the b.c. method to 4 generators.
3. `classifier_batch` - is the experiment that uses the TVD-based loss during generator training.
4. `different_workloads` - is a work in progress experiment to extend the functionality to 10 generators.
   
(The `master` branch contains boilerplate code and does not contain any experiment)

In each branch there are 5 python files - 

1. `hyperparameters.py` - This file contains all the hyperparameters required for the training and evaluation of the network.
2. `utils.py` - Contains the helper functions and classes, such as custom callbacks, metrics and dataloaders.
3. `model.py` - Contains all the model related definitions such as the structure, `train_step` to run, etc.
4. `train.py` - This is the main script to run when you want to train the model. This script defines the loss functions for each individual model and calls the `model.fit()` method, to execute the `train_step`. It takes an optional argument `-c` or `--from_checkpoint`, which can be used if you want to load pre-trained models (stored in `./models/`).
5. `evaluate.py` - This is the main script to run when you want to evaluate the metrics such as FID, TVD (pairwise) and average class probabilities. This script will automatically load the models stored in the `./models/` directory and use them to evaluate each generator individually and together. It will print all the metrics on the console.

The directory structure is as defined below - 

- `generated_images` - This directory contains the generated images, both during training and evaluation. The subfolder `gen` contains the images generated during evaluation while `gen(i)` contains images generated by the i'th generator during training at `save_freq` intervals.
- `logs` - contains log files written during training by the `tensorboard_callback`.
- `models` - contains all the pre-trained models.

To train the model from scratch, run the line:

`python train.py`

To use pre-trained models and continue training:

`python train.py -c` OR `python train.py --from_checkpoint`

To evaluate metrics (This will only use pre-trained models from `./models/`):

`python evaluate.py`

## Pre-trained models

The pre-trained models for each experiment are hosted on the link:

- [Pre-trained models](https://drive.google.com/drive/folders/1lQjAowsZ9pyw_8w3SkbRz7UUzc3_n59x?usp=sharing) - trained using the default hyperparameters mentioned in the paper.

## Results

### Experiment 1 (TVD loss + b.c.)

Generator mean FID = 3.6023

Generators' image distance = 0.9965 (TVD)

Average class probability generated by gen0(%):

[18.98, 21.77, 0.47, 0.03, 18.96, 0.00, 0.13, 19.47, 0.5, 19.69  ]

Average class probability generated by gen1(%):

[0.51, 0.04, 21.25, 19.79, 0.16, 17.9, 23.48, 0.01, 16.82, 0.05]

### Experiment 2 (b.c. only)

Generator mean FID = 4.7382

Generators' image distance = 0.9832 (TVD)

Average class probability generated by gen0(%):

[0.00, 27.23,   13.23,    0.63, 18.91,   0.00, 0.00, 22.46,     0.32, 17.23]

Average class probability generated by gen1(%):

[19.15,    0.01,  8.94,   19.75,     0.06, 17.19, 18.35,    0.29,  14.93,   1.31]

### Experiment 3 (4 generators)

Generator mean FID = 2.9439

Generators' image distance = 0.9633 (TVD)

Average class probability generated by gen0(%):

[0.02,  0.15,  0.04,  13.00,    6.91,   4.92, 36.91,    0.11,  33.14,    4.80]

Average class probability generated by gen1(%):

[38.99,    0.00, 11.32,   22.84,    0.01, 24.13,  0.03,  0.00,  2.33,   0.33]

Average class probability generated by gen2(%):

[0.15,  45.49,    15.88,    0.14, 31.99,   0.68,  2.65,   0.86,  0.84,   1.31]

Average class probability generated by gen3(%):

[0.36,    0.29, 22.05,     2.46,    0.72,  0.95,  0.00, 41.96,    1.94,  29.25]